<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Generaci√≥n de PDF de Rankings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background-color: #f8f9fa;
        }
        .code {
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
        }
        .button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prueba de Generaci√≥n de PDF de Rankings</h1>
        <p>Esta p√°gina te guiar√° paso a paso para probar la funcionalidad de generaci√≥n de PDFs de rankings.</p>
        
        <div class="step">
            <h3>Paso 1: Abrir la aplicaci√≥n</h3>
            <p>Haz clic en el siguiente bot√≥n para abrir la aplicaci√≥n en una nueva pesta√±a:</p>
            <button class="button" onclick="openApp()">Abrir Aplicaci√≥n</button>
        </div>
        
        <div class="step">
            <h3>Paso 2: Inyectar datos de prueba</h3>
            <p>Una vez que la aplicaci√≥n est√© cargada, sigue estas instrucciones:</p>
            <ol>
                <li>Abre la consola de desarrollador (F12 o Ctrl+Shift+I)</li>
                <li>Copia y pega el siguiente c√≥digo en la consola:</li>
            </ol>
            <div class="code" id="injectionCode">
                // Cargando c√≥digo de inyecci√≥n...
            </div>
            <button class="button" onclick="copyInjectionCode()">Copiar C√≥digo</button>
            <p id="copyStatus"></p>
        </div>
        
        <div class="step">
            <h3>Paso 3: Navegar a Rankings</h3>
            <p>Despu√©s de inyectar los datos, navega a la p√°gina de Rankings usando el men√∫ de navegaci√≥n o directamente en:</p>
            <div class="code">http://localhost:3006/rankings</div>
        </div>
        
        <div class="step">
            <h3>Paso 4: Generar PDF</h3>
            <p>En la p√°gina de Rankings:</p>
            <ol>
                <li>Verifica que los datos se carguen correctamente (deber√≠as ver 3 rankings)</li>
                <li>Haz clic en el bot√≥n "Exportar PDF"</li>
                <li>Ingresa un nombre de empresa cuando se solicite</li>
                <li>Espera a que se complete la generaci√≥n del PDF</li>
            </ol>
        </div>
        
        <div class="step">
            <h3>Paso 5: Verificar resultados</h3>
            <p>Una vez generado el PDF, verifica:</p>
            <ul>
                <li>El tama√±o del archivo (debe ser menor a 20MB)</li>
                <li>La primera p√°gina contiene el texto de introducci√≥n</li>
                <li>Las p√°ginas siguientes est√°n en orientaci√≥n horizontal</li>
                <li>Los rankings se ven m√°s grandes y legibles</li>
                <li>Cada ranking est√° centrado en su p√°gina</li>
            </ul>
        </div>
        
        <div class="step">
            <h3>Caracter√≠sticas implementadas:</h3>
            <ul>
                <li><span class="success">‚úì</span> P√°gina de introducci√≥n con texto explicativo</li>
                <li><span class="success">‚úì</span> Optimizaci√≥n de html2canvas (scale de 8 a 2, maxWidth de 2400px a 1200px)</li>
                <li><span class="success">‚úì</span> Orientaci√≥n horizontal para p√°ginas de rankings</li>
                <li><span class="success">‚úì</span> Zoom x1.5 y centrado de rankings</li>
            </ul>
        </div>
    </div>

    <script>
        // C√≥digo de inyecci√≥n de datos
        const injectionCode = `
// Datos de prueba para rankings
const testData = {
  id: "test-report-123",
  user_id: "demo_user",
  file_name: "Reporte StandLite2 - 3 camiones - 20 al 26 de octubre.xlsx",
  vehicle_plate: "YHLE15",
  date_range: {
    start: "20/10/2025",
    end: "26/10/2025"
  },
  summary: {
    totalAlarms: 50,
    alarmTypes: {
      "Conductor distra√≠do": 20,
      "Cruce de carril": 12,
      "Cintur√≥n de seguridad": 6,
      "Infracci√≥n de se√±al de stop": 4,
      "Fatiga": 2,
      "Tel√©fono M√≥vil": 5,
      "Distancia de Seguridad": 1
    },
    videosRequested: 0
  },
  events: [
    { timestamp: "20/10/25, 08:30:15", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Conductor mirando hacia abajo por m√°s de 3 segundos.", severity: "Moderado" },
    { timestamp: "20/10/25, 09:15:22", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Cambio de carril sin se√±alizar debidamente.", severity: "Leve" },
    { timestamp: "20/10/25, 10:45:33", alarmType: "Cintur√≥n de seguridad", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Conductor sin cintur√≥n de seguridad detectado.", severity: "Grave" },
    { timestamp: "20/10/25, 11:20:44", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Moderado" },
    { timestamp: "20/10/25, 14:30:55", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Uso de tel√©fono m√≥vil mientras conduce detectado.", severity: "Grave" },
    { timestamp: "20/10/25, 15:45:12", alarmType: "Cruce de carril", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Veh√≠culo cruzando l√≠nea continua de carril.", severity: "Moderado" },
    { timestamp: "20/10/25, 16:10:28", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Conductor no mantiene atenci√≥n en la carretera.", severity: "Leve" },
    { timestamp: "20/10/25, 17:35:41", alarmType: "Infracci√≥n de se√±al de stop", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Veh√≠culo no detuvo completamente en se√±al de stop.", severity: "Grave" },
    { timestamp: "20/10/25, 18:20:08", alarmType: "Fatiga", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Signos de fatiga detectados en el conductor.", severity: "Cr√≠tico" },
    { timestamp: "21/10/25, 07:45:19", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Posible uso de dispositivo m√≥vil detectado.", severity: "Moderado" },
    { timestamp: "21/10/25, 09:12:34", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Maniobra de cambio de carril peligrosa detectada.", severity: "Moderado" },
    { timestamp: "21/10/25, 10:30:45", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Conductor manipulando dispositivo electr√≥nico.", severity: "Grave" },
    { timestamp: "21/10/25, 11:45:56", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "21/10/25, 14:20:12", alarmType: "Cintur√≥n de seguridad", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Sensor de cintur√≥n desactivado durante la conducci√≥n.", severity: "Grave" },
    { timestamp: "21/10/25, 15:35:28", alarmType: "Cruce de carril", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Cruce involuntario de carril detectado.", severity: "Leve" },
    { timestamp: "21/10/25, 16:50:41", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Conductor mirando hacia abajo por m√°s de 3 segundos.", severity: "Moderado" },
    { timestamp: "21/10/25, 18:15:55", alarmType: "Distancia de Seguridad", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Distancia de seguimiento demasiado corta.", severity: "Cr√≠tico" },
    { timestamp: "22/10/25, 08:30:08", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "22/10/25, 09:45:22", alarmType: "Cruce de carril", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Cambio de carril sin se√±alizar debidamente.", severity: "Moderado" },
    { timestamp: "22/10/25, 11:10:35", alarmType: "Infracci√≥n de se√±al de stop", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Paso semaforizado sin detenci√≥n completa.", severity: "Grave" },
    { timestamp: "22/10/25, 14:35:48", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Conductor no mantiene atenci√≥n en la carretera.", severity: "Moderado" },
    { timestamp: "22/10/25, 16:20:12", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Detecci√≥n de tel√©fono en mano durante conducci√≥n.", severity: "Grave" },
    { timestamp: "22/10/25, 17:45:25", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Veh√≠culo cruzando l√≠nea continua de carril.", severity: "Leve" },
    { timestamp: "22/10/25, 19:10:38", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Posible uso de dispositivo m√≥vil detectado.", severity: "Moderado" },
    { timestamp: "23/10/25, 07:25:51", alarmType: "Cintur√≥n de seguridad", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Cintur√≥n de seguridad no abrochado al iniciar viaje.", severity: "Grave" },
    { timestamp: "23/10/25, 09:40:14", alarmType: "Conductor distra√≠do", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "23/10/25, 11:55:27", alarmType: "Cruce de carril", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Maniobra de cambio de carril peligrosa detectada.", severity: "Moderado" },
    { timestamp: "23/10/25, 14:20:43", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Uso de celular prohibido detectado por c√°mara.", severity: "Grave" },
    { timestamp: "23/10/25, 16:35:56", alarmType: "Conductor distra√≠do", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Conductor mirando hacia abajo por m√°s de 3 segundos.", severity: "Moderado" },
    { timestamp: "23/10/25, 18:50:09", alarmType: "Fatiga", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Bostezos frecuentes y somnolencia detectada.", severity: "Cr√≠tico" },
    { timestamp: "24/10/25, 08:15:22", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "24/10/25, 10:30:35", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Cruce involuntario de carril detectado.", severity: "Moderado" },
    { timestamp: "24/10/25, 12:45:48", alarmType: "Infracci√≥n de se√±al de stop", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Detenci√≥n parcial en se√±al de stop.", severity: "Grave" },
    { timestamp: "24/10/25, 15:10:01", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Conductor no mantiene atenci√≥n en la carretera.", severity: "Moderado" },
    { timestamp: "24/10/25, 17:25:14", alarmType: "Cintur√≥n de seguridad", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Detecci√≥n de cintur√≥n desabrochado en movimiento.", severity: "Grave" },
    { timestamp: "24/10/25, 19:40:27", alarmType: "Cruce de carril", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Cambio de carril sin se√±alizar debidamente.", severity: "Leve" },
    { timestamp: "25/10/25, 07:55:40", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Posible uso de dispositivo m√≥vil detectado.", severity: "Moderado" },
    { timestamp: "25/10/25, 10:10:53", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Conductor manipulando dispositivo electr√≥nico.", severity: "Grave" },
    { timestamp: "25/10/25, 12:25:06", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "25/10/25, 14:40:19", alarmType: "Cruce de carril", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Veh√≠culo cruzando l√≠nea continua de carril.", severity: "Moderado" },
    { timestamp: "25/10/25, 16:55:32", alarmType: "Conductor distra√≠do", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Conductor mirando hacia abajo por m√°s de 3 segundos.", severity: "Moderado" },
    { timestamp: "25/10/25, 19:10:45", alarmType: "Infracci√≥n de se√±al de stop", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Infracci√≥n de se√±al de alto detectada.", severity: "Grave" },
    { timestamp: "26/10/25, 08:25:58", alarmType: "Conductor distra√≠do", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Detecci√≥n de distracci√≥n visual prolongada.", severity: "Leve" },
    { timestamp: "26/10/25, 09:40:11", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Maniobra de cambio de carril peligrosa detectada.", severity: "Moderado" },
    { timestamp: "26/10/25, 11:55:24", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Conductor no mantiene atenci√≥n en la carretera.", severity: "Moderado" },
    { timestamp: "26/10/25, 14:10:37", alarmType: "Tel√©fono M√≥vil", vehiclePlate: "YHLE15", driver: "Juan P√©rez Silva (StandLite2)", comments: "Uso de tel√©fono m√≥vil mientras conduce detectado.", severity: "Grave" },
    { timestamp: "26/10/25, 17:25:50", alarmType: "Cruce de carril", vehiclePlate: "MPGJ87", driver: "Mar√≠a Gonz√°lez Rodr√≠guez (StandLite2)", comments: "Cruce involuntario de carril detectado.", severity: "Leve" },
    { timestamp: "26/10/25, 19:40:03", alarmType: "Conductor distra√≠do", vehiclePlate: "QRIL76", driver: "Carlos L√≥pez Mu√±oz (StandLite2)", comments: "Posible uso de dispositivo m√≥vil detectado.", severity: "Moderado" }
  ],
  charts: {
    alarmTypeDistribution: {
      labels: ["Conductor distra√≠do", "Cruce de carril", "Cintur√≥n de seguridad", "Infracci√≥n de se√±al de stop", "Fatiga", "Tel√©fono M√≥vil", "Distancia de Seguridad"],
      data: [20, 12, 6, 4, 2, 5, 1],
      backgroundColor: ["#ffa724ff", "#7c14a5ff", "#b71c1c", "#424242", "#42b4b8ff", "#2e7400ff", "#0d47a1"]
    },
    dailyEvolution: {
      labels: ["20/10", "21/10", "22/10", "23/10", "24/10", "25/10", "26/10"],
      data: [5, 6, 7, 6, 6, 6, 4]
    },
    hourlyDistribution: {
      labels: ["00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"],
      data: [0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 4, 0, 0, 4, 3, 4, 3, 4, 4, 0, 0, 0, 0]
    }
  },
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  status: "processed",
  operation: "upsert"
};

// Funci√≥n para inyectar datos en Redux
function injectTestData() {
  // Intentar diferentes formas de acceder al store
  let store = null;
  
  // M√©todo 1: Buscar en el objeto window
  if (window.__REDUX_STORE__) {
    store = window.__REDUX_STORE__;
  } else {
    // M√©todo 2: Buscar en el DOM
    const reactRoot = document.querySelector('#root');
    if (reactRoot && reactRoot._reactRootContainer && reactRoot._reactRootContainer._internalRoot) {
      const fiber = reactRoot._reactRootContainer._internalRoot.current;
      if (fiber && fiber.child && fiber.child.stateNode && fiber.child.stateNode.store) {
        store = fiber.child.stateNode.store;
      }
    }
  }
  
  if (!store) {
    console.error('No se encontr√≥ el store de Redux. Intenta recargar la p√°gina y ejecutar el c√≥digo nuevamente.');
    return;
  }
  
  // Despachar la acci√≥n para establecer el reporte actual
  store.dispatch({
    type: 'excel/uploadExcel/fulfilled',
    payload: testData
  });
  
  console.log('‚úÖ Datos de prueba inyectados exitosamente');
  console.log('üìä Ahora puedes navegar a la p√°gina de Rankings: http://localhost:3006/rankings');
  console.log('üîç En Rankings, verifica que se muestren los 3 rankings correctamente');
  console.log('üìÑ Luego haz clic en "Exportar PDF" para probar la generaci√≥n');
}

// Ejecutar la inyecci√≥n
injectTestData();
        `;

        // Mostrar el c√≥digo en la p√°gina
        document.getElementById('injectionCode').textContent = injectionCode;

        function openApp() {
            window.open('http://localhost:3006', '_blank');
        }

        function copyInjectionCode() {
            const codeElement = document.getElementById('injectionCode');
            const textArea = document.createElement('textarea');
            textArea.value = codeElement.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            const statusElement = document.getElementById('copyStatus');
            statusElement.innerHTML = '<span class="success">‚úÖ C√≥digo copiado al portapapeles</span>';
            setTimeout(() => {
                statusElement.innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html>